<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Entity Manager: A Demonstration - some words</title>
<meta name="description" content="Presenting a step-by-step Typescript implementation of a realistic data model against DynamoDB, with the help of Entity Manager.">


  <meta name="author" content="Jason Williscroft">
  
  <meta property="article:author" content="Jason Williscroft">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="some words">
<meta property="og:title" content="Entity Manager: A Demonstration">
<meta property="og:url" content="https://karmanivero.us/projects/entity-manager/demo/">


  <meta property="og:description" content="Presenting a step-by-step Typescript implementation of a realistic data model against DynamoDB, with the help of Entity Manager.">



  <meta property="og:image" content="https://karmanivero.us/assets/collections/entity-manager/configuration-banner.jpg">



  <meta name="twitter:site" content="@karmaniverous">
  <meta name="twitter:title" content="Entity Manager: A Demonstration">
  <meta name="twitter:description" content="Presenting a step-by-step Typescript implementation of a realistic data model against DynamoDB, with the help of Entity Manager.">
  <meta name="twitter:url" content="https://karmanivero.us/projects/entity-manager/demo/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://karmanivero.us/assets/collections/entity-manager/configuration-banner.jpg">
  

  



  <meta property="article:published_time" content="2024-11-21T02:10:13+00:00">






<link rel="canonical" href="https://karmanivero.us/projects/entity-manager/demo/">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="some words Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="text/javascript">
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  window.enable_copy_code_button = true;
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link
  rel="apple-touch-icon"
  sizes="180x180"
  href="/assets/favicon/apple-touch-icon.png" />
<link
  rel="icon"
  type="image/png"
  sizes="32x32"
  href="/assets/favicon/favicon-32x32.png" />
<link
  rel="icon"
  type="image/png"
  sizes="16x16"
  href="/assets/favicon/favicon-16x16.png" />
<link rel="manifest" href="/assets/favicon/site.webmanifest" />
<link
  rel="mask-icon"
  href="/assets/favicon/safari-pinned-tab.svg"
  color="#5bbad5" />
<link rel="shortcut icon" href="/assets/favicon/favicon.ico" />
<meta name="msapplication-TileColor" content="#2b5797" />
<meta name="msapplication-config" content="/assets/favicon/browserconfig.xml" />
<meta name="theme-color" content="#ffffff" />



<!-- Mathjax Support -->
<script
  type="text/javascript"
  async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          some words
          <span class="site-subtitle">many of them true</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/projects/"
                
                
              >Projects</a>
            </li><li class="masthead__menu-item">
              <a
                href="/toolkits/"
                
                
              >Toolkits</a>
            </li><li class="masthead__menu-item">
              <a
                href="/bali/"
                
                
              >Bali</a>
            </li><li class="masthead__menu-item">
              <a
                href="/topics/"
                
                
              >Topics</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/"
                
                
              >Archive</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(32, 0, 32, 0.6), rgba(32, 0, 32, 0.6)), url('/assets/collections/entity-manager/configuration-banner-half.jpg');">
  
    <div class="wrapper">
      <h1
        id="page-title"
        class="page__title"
        itemprop="headline">
        
          Entity Manager: A Demonstration

        
      </h1>
      
        <p class="page__lead">Presenting a step-by-step Typescript implementation of a realistic data model against DynamoDB, with the help of Entity Manager.
</p>
      
      
        <div class="page__lead under_construction">
          <div>🚧</div>
          <div>UNDER CONSTRUCTION</div>
          <div>🚧</div>
        </div>
      
      

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-clock"
          aria-hidden="true"
        ></i>
        
          15
          minute read
        
      </span>
    
  </p>


      
    </div>
  
  
    <span class="page__hero-caption"><a href="/projects/entity-manager/"><strong>Entity Manager</strong> project documentation</a>
</span>
  
</div>






<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      <nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      
      
        <li>
          
            <span class="nav__sub-title">Entity Manager</span>
          

          
          <ul>
            
              <li><a href="/projects/entity-manager/intro/">Introduction</a></li>
            
              <li><a href="/projects/entity-manager/sql-vs-nosql/">SQL vs NoSQL</a></li>
            
              <li><a href="/projects/entity-manager/evolving-a-nosql-db-schema/">Evolving a NoSQL DB Schema</a></li>
            
          </ul>
          
        </li>
      
        <li>
          
            <span class="nav__sub-title">Usage</span>
          

          
          <ul>
            
              <li><a href="/projects/entity-manager/demo/" class="active">Demo</a></li>
            
              <li><a href="/projects/entity-manager/configuration/">Configuration</a></li>
            
          </ul>
          
        </li>
      
        <li>
          
            <span class="nav__sub-title">Packages</span>
          

          
          <ul>
            
              <li><a href="/projects/entity-manager/intro/#entity-manager"><code>entity-manager</code></a></li>
            
              <li><a href="/projects/entity-manager/intro/#entity-manager-demo"><code>entity-manager-demo</code></a></li>
            
              <li><a href="/projects/entity-manager/intro/#entity-client-dynamodb"><code>entity-client-dynamodb</code></a></li>
            
              <li><a href="/projects/entity-manager/intro/#entity-tools"><code>entity-tools</code></a></li>
            
              <li><a href="/projects/entity-manager/intro/#mock-db"><code>mock-db</code></a></li>
            
          </ul>
          
        </li>
      
    
  </ul>
</nav>

    
  
  </div>



  <article
    class="page"
    itemscope
    itemtype="https://schema.org/CreativeWork"
    >
    <meta itemprop="headline" content="Entity Manager: A Demonstration">
    <meta itemprop="description" content="Presenting a step-by-step Typescript implementation of a realistic data model against DynamoDB, with the help of Entity Manager.">
    <meta itemprop="datePublished" content="2024-11-21T02:10:13+00:00">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header>
                <h4 class="nav__title">
                  <i class="fas fa-file-alt"></i>
                  On this page</h4>
              </header>
              <ul class="toc__menu"><li><a href="#an-overview">An Overview</a></li><li><a href="#dynamodb-local-integration">DynamoDB Local Integration</a></li><li><a href="#setting-up-the-demo">Setting Up The Demo</a></li><li><a href="#logger">Logger</a></li><li><a href="#entitymanager-configuration">EntityManager Configuration</a><ul><li><a href="#myentitymap-type">MyEntityMap Type</a></li><li><a href="#config-object">config Object</a></li><li><a href="#item-types">Item Types</a></li></ul></li><li><a href="#entityclient-configuration">EntityClient Configuration</a></li><li><a href="#endpoint-handlers">Endpoint Handlers</a><ul><li><a href="#email-entity">Email Entity</a><ul><li><a href="#create-email">Create Email</a></li><li><a href="#read-email">Read Email</a></li><li><a href="#delete-email">Delete Email</a></li><li><a href="#search-emails">Search Emails</a></li></ul></li><li><a href="#user-entity">User Entity</a><ul><li><a href="#create-user">Create User</a></li><li><a href="#read-user">Read User</a></li><li><a href="#update-user">Update User</a></li><li><a href="#delete-user">Delete User</a></li><li><a href="#search-users">Search Users</a></li></ul></li></ul></li></ul>
            </nav>
          </aside>
        
        <figure class="align-left drop-image">
    <img src="/assets/collections/entity-manager/configuration-square.jpg" />
</figure>

<p>Your project’s data needs are complex. <strong>Entity Manager</strong> simplifies the problem by encapsulating a provider-agnostic, highly opinionated approach to the single-table design pattern.</p>

<p>At the end of the day, though, you have to implement a <em>specific</em> data model against a <em>specific</em> database platform. This guide presents a step-by-step Typescript implementation of a realistic data model against <a href="https://aws.amazon.com/dynamodb/">DynamoDB</a>, with the help of <strong>Entity Manager</strong>.</p>

<p>The <a href="https://github.com/karmaniverous/entity-manager-demo"><code class="language-plaintext highlighter-rouge">entity-manager-demo</code></a> repository contains the full implementation documented below.</p>

<p class="notice--warning"><strong>This page is under construction!</strong> The Typescript refactor is nearly complete, and I’m busy building the demo &amp; syncing up this documentation. Please check back soon for updates and <a href="https://github.com/karmaniverous/entity-manager/discussions">drop me a note</a> with any questions or ideas!.</p>

<h2 id="an-overview">An Overview</h2>

<p>As the basis of this demonstration we will use the same data model, table design, and index structure we worked up in <a href="/projects/entity-manager/evolving-a-nosql-db-schema/">Evolving a NoSQL DB Schema</a>. If you haven’t read this article yet, I recommend you do so before proceeding as it will help you understand <em>why</em> we settled on the design we chose.</p>

<p>If you just want to review the resulting design, see the <a href="/projects/entity-manager/evolving-a-nosql-db-schema/#recap">Recap</a> section at the end of that article.</p>

<figure class=""><img src="/assets/diagrams/entity-manager-evolving-a-nosql-db-schema-data-model.png" alt="" /><figcaption>
      <em>User service data model.</em>

    </figcaption></figure>

<p>While all <strong>Entity Manager</strong> entity records are technically sharded, by default each record’s shard key is an empty string, resulting in effectively unsharded data. To demonstrate <strong>Entity Manager</strong>’s ability to scale, we will configure a sharding schedule for each entity that will allow us to test both unsharded and sharded scenarios.</p>

<p>The details of an API implementation are beyond the scope of this demo, but we will develop the handler functions an API would call to perform the following operations against the above data model in DynamoDB using <strong>Entity Manager</strong>:</p>

<ul>
  <li>Email entity:
    <ul>
      <li>Create a new email record.</li>
      <li>Delete an email record.</li>
      <li>Retrieve a list of email records by <code class="language-plaintext highlighter-rouge">userId</code>.</li>
    </ul>
  </li>
  <li>User entity:
    <ul>
      <li>Create a new user record.</li>
      <li>Retrieve a user record by <code class="language-plaintext highlighter-rouge">userId</code>.</li>
      <li>Update a user record.</li>
      <li>Delete a user record and associated email records.</li>
      <li>Retrieve a list of user records by various search criteria, including a multi-index match against both <code class="language-plaintext highlighter-rouge">firstName</code> and <code class="language-plaintext highlighter-rouge">lastName</code>.</li>
    </ul>
  </li>
</ul>

<p>We’ll also demonstrate how to leverage your <strong>Entity Manager</strong> config to generate a definition for your DynamoDB table, and how to use the <a href="https://github.com/karmaniverous/entity-client-dynamodb"><code class="language-plaintext highlighter-rouge">entity-client-dynamodb</code></a> to create this table and efficiently perform other table-level database operations in DynamoDB.</p>

<p>We’ll write <a href="https://mochajs.org"><code class="language-plaintext highlighter-rouge">mocha</code></a>/<a href="https://www.chaijs.com/"><code class="language-plaintext highlighter-rouge">chai</code></a> unit tests to exercise all this functionality against DynamoDB using the <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DynamoDBLocal.html">DynamoDB Local</a> emulator running in a Docker container. This will allow you to run the demo on your local machine without incurring any AWS costs (though these would be trivial) and without requiring an active connection to AWS.</p>

<p>You should be abe to pull the repository, install dependencies, and run all unit tests successfully within just a few minutes. <strong>So let’s get started!</strong></p>

<p class="notice--info">For convenience, this repository uses my <a href="https://github.com/karmaniverous/npm-package-template-ts">Typescript NPM Package Template</a>, only I’ve stripped out the CLI &amp; <a href="https://rollupjs.org/">Rollup</a> build and have disabled NPM publishing. So what remains is a pure, <a href="https://semver.org/">semantic-versioned</a> Typescript “package” with a bunch of unit tests: perfect for a demo that can evolve over time, useless for anything else.</p>

<h2 id="dynamodb-local-integration">DynamoDB Local Integration</h2>

<p>There are a couple of different ways to run DynamoDB locally. See the <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DynamoDBLocal.html">DynamoDB Local</a> documentation for details.</p>

<p>To keep things simple, this demo executes its tests against DynamoDB running in a Docker image. The only requirement is that <a href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a> be installed &amp; running. When you execute a test, the test suite will download the Docker image if it isn’t already present, start the container, run the tests, and then stop &amp; delete the container.</p>

<p>Setting up Docker Desktop is beyond the scope of this guide, but if you’re on a Windows machine and have <a href="https://community.chocolatey.org/">Chocolatey</a>, it’s easy: run <code class="language-plaintext highlighter-rouge">choco install docker-desktop</code> from an admin prompt. You’ll want to restart your machine once installation completes.</p>

<p class="notice--warning"><strong>If your first test execution seems to hang, check the output panel!</strong> The DynamoDB Local Docker image takes a couple of minutes to download &amp; install, but you’ll only have to do that once. If your tests fail outright, make sure Docker Desktop is actually running!</p>

<h2 id="setting-up-the-demo">Setting Up The Demo</h2>

<p>After you have Docker Desktop installed &amp; running, follow these steps:</p>

<ol>
  <li>
    <p>Clone the <a href="https://github.com/karmaniverous/entity-manager-demo"><code class="language-plaintext highlighter-rouge">entity-manager-demo</code></a> repository to your local machine.</p>
  </li>
  <li>
    <p>Install dependencies by running <code class="language-plaintext highlighter-rouge">npm install</code> from the repository root.</p>
  </li>
  <li>
    <p>Optionally, install <a href="https://marketplace.visualstudio.com/items?itemName=hbenl.vscode-mocha-test-adapter">Mocha Test Explorer</a> to make it a bit easier to follow along with the examples below.</p>
  </li>
</ol>

<p>That’s it! Check your work by running <code class="language-plaintext highlighter-rouge">npm test</code> from the repository root. If all the tests pass, you’re ready to start exploring the code!</p>

<p class="notice--info"><strong>If you run into any trouble</strong>, please <a href="https://github.com/karmaniverous/entity-manager-demo/discussions">start a discussion</a> and I’ll help!</p>

<h2 id="logger">Logger</h2>

<figure class=""><img src="https://raw.githubusercontent.com/karmaniverous/entity-manager-demo/main/assets/logger.png" alt="" /><figcaption>
      <em>Logger configuration.</em>

    </figcaption></figure>

<p>All packages in the <strong>Entity Manager</strong> ecosystem perform extensive debug logging by default. This is often very useful when troubleshooting projects that leverage these packages, but it can also inject a lot of noise into the console when you’re trying to focus on your <em>own</em> code with its <em>own</em> debug logging.</p>

<p><strong>Entity Manager</strong> packages also support an injected logger object. To address the noise issue, we will…</p>

<ul>
  <li>
    <p>Alias <code class="language-plaintext highlighter-rouge">console</code> to <code class="language-plaintext highlighter-rouge">logger</code> and use it everywhere we want logging in our demo. The demo will work just as well if you replace <code class="language-plaintext highlighter-rouge">console</code> with <code class="language-plaintext highlighter-rouge">winston</code> or some other logger of choice.</p>
  </li>
  <li>
    <p>Use the <code class="language-plaintext highlighter-rouge">controlledProxy</code> function to proxy the <code class="language-plaintext highlighter-rouge">logger</code> object and disable the <code class="language-plaintext highlighter-rouge">debug</code> endpoint. When we inject the resulting <code class="language-plaintext highlighter-rouge">errorLogger</code> object into our <code class="language-plaintext highlighter-rouge">EntityManager</code> and <code class="language-plaintext highlighter-rouge">Entity Client</code> instances, all of their internal debug logging will be suppressed.</p>
  </li>
</ul>

<p>Visit <a href="https://github.com/karmaniverous/entity-manager-demo/blob/main/src/logger.ts"><code class="language-plaintext highlighter-rouge">logger.ts</code></a> to see this code in context.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">controlledProxy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@karmaniverous/controlled-proxy</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// Use the console logger. This could easily be replaced with a</span>
<span class="c1">// custom logger like winston.</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">logger</span> <span class="o">=</span> <span class="nx">console</span><span class="p">;</span>

<span class="c1">// Proxy the logger &amp; disable debug logging.</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">errorLogger</span> <span class="o">=</span> <span class="nx">controlledProxy</span><span class="p">({</span>
  <span class="na">defaultControls</span><span class="p">:</span> <span class="p">{</span> <span class="na">debug</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span>
  <span class="na">target</span><span class="p">:</span> <span class="nx">logger</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="entitymanager-configuration"><code class="language-plaintext highlighter-rouge">EntityManager</code> Configuration</h2>

<figure class=""><img src="https://raw.githubusercontent.com/karmaniverous/entity-manager-demo/main/assets/entityManager.png" alt="" /><figcaption>
      <em><code class="language-plaintext highlighter-rouge">EntityManager</code> configuration.</em>

    </figcaption></figure>

<p><strong>Entity Manager</strong> configuration is a complex topic! Our purpose here is to focus specifically on our demonstration scenario. <a href="/projects/entity-manager/configuration/">Click here</a> for a deeper dive into all aspects of <strong>Entity Manager</strong> configuration.</p>

<p class="notice--warning"><strong>Entity Manager is a Typescript-first tool!</strong> If you are writing Javascript, you can skip the type-related parts of this guide and your config will still be validated for you at run time. You just won’t get the compile-time type checking that Typescript provides.</p>

<p>The <a href="https://docs.karmanivero.us/entity-manager/classes/entity_manager.EntityManager.html"><code class="language-plaintext highlighter-rouge">EntityManager</code></a> class configuration object is defined in the <a href="https://docs.karmanivero.us/entity-manager/types/entity_manager.Config.html"><code class="language-plaintext highlighter-rouge">Config</code></a> type. Internally this type is <em>very</em> complex, in order to support all kinds of compile-time validations. Once the config is parsed, though, it takes on the <a href="https://docs.karmanivero.us/entity-manager/types/entity_manager.ParsedConfig.html"><code class="language-plaintext highlighter-rouge">ParsedConfig</code></a> type, <strong>which has the same form and is quite a bit easier to read!</strong></p>

<p>Creating an <code class="language-plaintext highlighter-rouge">EntityManager</code> instance is really about creating a valid <code class="language-plaintext highlighter-rouge">Config</code> object.</p>

<p>The <code class="language-plaintext highlighter-rouge">Config</code> type has four type parameters. Only the first one is required, and for this demo we will use defaults for the other three. Here they are:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">M extends</code><a href="/projects/entity-manager/configuration/#the-entitymap-type"><code class="language-plaintext highlighter-rouge">EntityMap</code></a> - This is the most important parameter and will be different in every implementation. We’ll address it below.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">HashKey extends string</code> - This is the name of the generated hash key property that will be shared across all entities in the configuration. The default value is <code class="language-plaintext highlighter-rouge">'hashKey'</code>, and we will use that here.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">RangeKey extends string</code> - This is the name of the generated range key property that will be shared across all entities in the configuration. The default value is <code class="language-plaintext highlighter-rouge">'rangeKey'</code>, and we will use that here.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">T extends</code><a href="/projects/entity-manager/configuration/#the-transcodemap-type"><code class="language-plaintext highlighter-rouge">TranscodeMap</code></a> - Relates the name of a <a href="/projects/entity-manager/configuration/#transcodes">transcode</a> to the type of the value being transcoded. This parameter defaults to an extensible <a href="https://docs.karmanivero.us/entity-tools/interfaces/entity_tools.DefaultTranscodeMap.html">DefaultTranscodeMap</a> type that will serve our purposes here.</p>
  </li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">EntityManager</code> constructor also takes a <code class="language-plaintext highlighter-rouge">logger</code> argument. To minimize noise in the demo console, the injected <code class="language-plaintext highlighter-rouge">errorLogger</code> proxies <code class="language-plaintext highlighter-rouge">console</code> to disable debug logging in the <code class="language-plaintext highlighter-rouge">EntityManager</code> instance while keeping it enabled elsewhere. See my <a href="https://github.com/karmaniverous/controlled-proxy"><code class="language-plaintext highlighter-rouge">controlled-proxy</code></a> repo for more info!</p>

<p>Let’s compose our configuration’s <code class="language-plaintext highlighter-rouge">EntityMap</code>.</p>

<h3 id="myentitymap-type"><code class="language-plaintext highlighter-rouge">MyEntityMap</code> Type</h3>

<p>An <a href="http://localhost:4000/projects/entity-manager/configuration/#the-entitymap-type"><code class="language-plaintext highlighter-rouge">EntityMap</code></a> is just a map of Typescript interfaces that define the structure of each entity in the configuration. The keys of the map are the entity names, and the values are the entity interfaces.</p>

<p>As a special convention, within each interface we identify <em>generated properties</em> (the ones marked with a ⚙️ in our <a href="/projects/entity-manager/evolving-a-nosql-db-schema/#table-properties">table design</a>) with a <code class="language-plaintext highlighter-rouge">never</code> type. This is a signal to the <code class="language-plaintext highlighter-rouge">Config</code> type that these properties require special support &amp; configuration. See the <code class="language-plaintext highlighter-rouge">EmailEntity</code> and <code class="language-plaintext highlighter-rouge">UserEntity</code> interfaces below for examples.</p>

<p>While we are at it, we will also construct and export the <code class="language-plaintext highlighter-rouge">Email</code> and <code class="language-plaintext highlighter-rouge">User</code> types. These are the same as <code class="language-plaintext highlighter-rouge">EmailEntity</code> and <code class="language-plaintext highlighter-rouge">UserEntity</code>, respectively, but we’ve stripped out all properties with the <code class="language-plaintext highlighter-rouge">never</code> type. These are useful for the rest of our application code, which doesn’t need to know about properties that are specific to data operations.</p>

<p>Here is the definition of <code class="language-plaintext highlighter-rouge">MyEntityMap</code> from <a href="https://github.com/karmaniverous/entity-manager-demo/blob/main/src/entityManager.ts"><code class="language-plaintext highlighter-rouge">entityManager.ts</code></a>:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="kd">type</span> <span class="p">{</span> <span class="nx">EntityMap</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@karmaniverous/entity-manager</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="kd">type</span> <span class="p">{</span>
  <span class="nx">Entity</span><span class="p">,</span>
  <span class="nx">PropertiesNotOfType</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@karmaniverous/entity-tools</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// Email entity interface. never types indicate generated properties.</span>
<span class="kr">interface</span> <span class="nx">EmailEntity</span> <span class="kd">extends</span> <span class="nx">Entity</span> <span class="p">{</span>
  <span class="nl">created</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">userHashKey</span><span class="p">:</span> <span class="nx">never</span><span class="p">;</span> <span class="c1">// generated</span>
  <span class="nl">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Email type for use outside data operations.</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">Email</span> <span class="o">=</span> <span class="nb">Pick</span><span class="o">&lt;</span>
  <span class="nx">EmailEntity</span><span class="p">,</span>
  <span class="nx">PropertiesNotOfType</span><span class="o">&lt;</span><span class="nx">EmailEntity</span><span class="p">,</span> <span class="nx">never</span><span class="o">&gt;</span>
<span class="o">&gt;</span><span class="p">;</span>

<span class="c1">// User entity interface. never types indicate generated properties.</span>
<span class="kr">interface</span> <span class="nx">UserEntity</span> <span class="kd">extends</span> <span class="nx">Entity</span> <span class="p">{</span>
  <span class="nl">beneficiaryId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">created</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">firstName</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">firstNameCanonical</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">firstNameRangeKey</span><span class="p">:</span> <span class="nx">never</span><span class="p">;</span> <span class="c1">// generated</span>
  <span class="nl">lastName</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">lastNameCanonical</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">lastNameRangeKey</span><span class="p">:</span> <span class="nx">never</span><span class="p">;</span> <span class="c1">// generated</span>
  <span class="nl">phone</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">updated</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">userBeneficiaryHashKey</span><span class="p">:</span> <span class="nx">never</span><span class="p">;</span> <span class="c1">// generated</span>
  <span class="nl">userHashKey</span><span class="p">:</span> <span class="nx">never</span><span class="p">;</span> <span class="c1">// generated</span>
  <span class="nl">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Email type for use outside data operations.</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">User</span> <span class="o">=</span> <span class="nb">Pick</span><span class="o">&lt;</span>
  <span class="nx">UserEntity</span><span class="p">,</span>
  <span class="nx">PropertiesNotOfType</span><span class="o">&lt;</span><span class="nx">UserEntity</span><span class="p">,</span> <span class="nx">never</span><span class="o">&gt;</span>
<span class="o">&gt;</span><span class="p">;</span>

<span class="c1">// Entity interfaces combined into EntityMap.</span>
<span class="kr">interface</span> <span class="nx">MyEntityMap</span> <span class="kd">extends</span> <span class="nx">EntityMap</span> <span class="p">{</span>
  <span class="nl">email</span><span class="p">:</span> <span class="nx">EmailEntity</span><span class="p">;</span>
  <span class="nl">user</span><span class="p">:</span> <span class="nx">UserEntity</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="config-object"><code class="language-plaintext highlighter-rouge">config</code> Object</h3>

<p>The <code class="language-plaintext highlighter-rouge">config</code> object has a lot of moving parts, so it helps to come at the problem from a specific direction.</p>

<p>The properties of the demo config object defined below are arranged accordingly and explained in the comments. For the mopart, only the Email entity config is commented, since the User config follows the same pattern.</p>

<p>Here are some important references from the comments:</p>

<ul>
  <li>
    <p>The demo <a href="/projects/entity-manager/evolving-a-nosql-db-schema/#table-properties">table design</a>.</p>
  </li>
  <li>
    <p>The demo <a href="http://localhost:4000/projects/entity-manager/evolving-a-nosql-db-schema/#indexes">index design</a>.</p>
  </li>
  <li>
    <p><a href="/projects/entity-manager/configuration/#transcodes">Transcodes</a> perform and reverse the conversion of a value into a string, often at a fixed width, for inclusion in a generated property while preserving its sorting characteristics. The <a href="https://github.com/karmaniverous/entity-tools/blob/main/src/defaultTranscodes.ts"><code class="language-plaintext highlighter-rouge">defaultTranscodes</code></a> object is used here since a <code class="language-plaintext highlighter-rouge">transcodes</code> object is not defined in the config. Available transcodes are:</p>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">bigint</code> - Renders a <code class="language-plaintext highlighter-rouge">bigint</code> as a variable-width string.</li>
      <li><code class="language-plaintext highlighter-rouge">bigint20</code> - Pads a <code class="language-plaintext highlighter-rouge">bigint</code> to a fixed width of 20 characters.</li>
      <li><code class="language-plaintext highlighter-rouge">boolean</code> - Renders as <code class="language-plaintext highlighter-rouge">'t'</code> or <code class="language-plaintext highlighter-rouge">'f'</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">fix6</code> - Pads a number to a fixed width with 6 decimal digits.</li>
      <li><code class="language-plaintext highlighter-rouge">int</code> - Pads a signed integer to a fixed width.</li>
      <li><code class="language-plaintext highlighter-rouge">number</code> - Renders a <code class="language-plaintext highlighter-rouge">number</code> as a variable-width string.</li>
      <li><code class="language-plaintext highlighter-rouge">string</code> - Variable-length pass-through.</li>
      <li><code class="language-plaintext highlighter-rouge">timestamp</code> - Pads a UNIX ms timestamp to a fixed width.</li>
    </ul>
  </li>
</ul>

<p>Visit <a href="https://github.com/karmaniverous/entity-manager-demo/blob/main/src/entityManager.ts"><code class="language-plaintext highlighter-rouge">entityManager.ts</code></a> to see this code in context.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span>
  <span class="kd">type</span> <span class="nx">Config</span><span class="p">,</span>
  <span class="nx">EntityManager</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@karmaniverous/entity-manager</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">errorLogger</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./logger</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// Current timestamp will act as break point for sharding schedule.</span>
<span class="kd">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="c1">// Config object for EntityManager.</span>
<span class="c1">// Using default values for HashKey, RangeKey, and TranscodeMap</span>
<span class="c1">// type params.</span>
<span class="kd">const</span> <span class="nx">config</span><span class="p">:</span> <span class="nx">Config</span><span class="o">&lt;</span><span class="nx">MyEntityMap</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// Common hash &amp; range key properties for all entities. Must</span>
  <span class="c1">// exactly match HashKey &amp; RangeKey type params.</span>
  <span class="na">hashKey</span><span class="p">:</span> <span class="dl">"</span><span class="s2">hashKey</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">rangeKey</span><span class="p">:</span> <span class="dl">"</span><span class="s2">rangeKey</span><span class="dl">"</span><span class="p">,</span>

  <span class="c1">// Entity-specific configs. Keys must exactly match those of</span>
  <span class="c1">// MyEntityMap.</span>
  <span class="na">entities</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// Email entity config.</span>
    <span class="na">email</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// Source property for the Email entity's hash key.</span>
      <span class="na">uniqueProperty</span><span class="p">:</span> <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">,</span>

      <span class="c1">// Source property for timestamp used to calculate Email</span>
      <span class="c1">// shard key.</span>
      <span class="na">timestampProperty</span><span class="p">:</span> <span class="dl">"</span><span class="s2">created</span><span class="dl">"</span><span class="p">,</span>

      <span class="c1">// Email entity's shard bump schedule. Records created before</span>
      <span class="c1">// now are unsharded (1 possible shard key). Records created</span>
      <span class="c1">// after now have a 1-char, 2-bit shard key (4 possible shard</span>
      <span class="c1">// keys).</span>
      <span class="na">shardBumps</span><span class="p">:</span> <span class="p">[{</span> <span class="na">timestamp</span><span class="p">:</span> <span class="nx">now</span><span class="p">,</span> <span class="na">charBits</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">chars</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}],</span>

      <span class="c1">// Email entity generated properties. These keys must match</span>
      <span class="c1">// the ones with never types in the Email interface defined</span>
      <span class="c1">// above, and are marked with a ⚙️ in the table design.</span>
      <span class="na">generated</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">userHashKey</span><span class="p">:</span> <span class="p">{</span>
          <span class="c1">// When true, if any element is undefined or null, the</span>
          <span class="c1">// generated property will be undefined. When false,</span>
          <span class="c1">// undefined or null elements will be rendered as an</span>
          <span class="c1">// empty string.</span>
          <span class="na">atomic</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>

          <span class="c1">// Elements of the generated property. These MUST be</span>
          <span class="c1">// ungenerated properties (i.e. not marked with never</span>
          <span class="c1">// in the Email interface) and MUST be included in the</span>
          <span class="c1">// entityTranscodes object below. Elements are applied</span>
          <span class="c1">// in order.</span>
          <span class="na">elements</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">userId</span><span class="dl">"</span><span class="p">],</span>

          <span class="c1">// When this value is true, the generated property will</span>
          <span class="c1">// be sharded.</span>
          <span class="na">sharded</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>

      <span class="c1">// Indexes for the Email entity as specified in the index</span>
      <span class="c1">// design.</span>
      <span class="na">indexes</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// An index hashKey must be either the global hash key or a</span>
        <span class="c1">// sharded generated property. Its rangeKey must be either</span>
        <span class="c1">// the global range key, an scalar ungenerated property, or</span>
        <span class="c1">// an unsharded generated property. Any ungenerated</span>
        <span class="c1">// properties used MUST be included in the entityTranscodes</span>
        <span class="c1">// object below.</span>
        <span class="na">created</span><span class="p">:</span> <span class="p">{</span> <span class="na">hashKey</span><span class="p">:</span> <span class="dl">"</span><span class="s2">hashKey</span><span class="dl">"</span><span class="p">,</span> <span class="na">rangeKey</span><span class="p">:</span> <span class="dl">"</span><span class="s2">created</span><span class="dl">"</span> <span class="p">},</span>
        <span class="na">userCreated</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">hashKey</span><span class="p">:</span> <span class="dl">"</span><span class="s2">userHashKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">rangeKey</span><span class="p">:</span> <span class="dl">"</span><span class="s2">created</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>

      <span class="c1">// Transcodes for ungenerated properties used as generated</span>
      <span class="c1">// property elements or index components. Transcode values</span>
      <span class="c1">// must be valid config transcodes object keys. Since this</span>
      <span class="c1">// config does not define a transcodes object it uses</span>
      <span class="c1">// defaultTranscodes exported by @karmaniverous/entity-tools.</span>
      <span class="na">elementTranscodes</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">created</span><span class="p">:</span> <span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">userId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">},</span>
    <span class="c1">// User entity config.</span>
    <span class="na">user</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">uniqueProperty</span><span class="p">:</span> <span class="dl">"</span><span class="s2">userId</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">timestampProperty</span><span class="p">:</span> <span class="dl">"</span><span class="s2">created</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">shardBumps</span><span class="p">:</span> <span class="p">[{</span> <span class="na">timestamp</span><span class="p">:</span> <span class="nx">now</span><span class="p">,</span> <span class="na">charBits</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">chars</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}],</span>
      <span class="na">generated</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">firstNameRangeKey</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">atomic</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="na">elements</span><span class="p">:</span> <span class="p">[</span>
            <span class="dl">"</span><span class="s2">firstNameCanonical</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">lastNameCanonical</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">created</span><span class="dl">"</span><span class="p">,</span>
          <span class="p">],</span>
        <span class="p">},</span>
        <span class="na">lastNameRangeKey</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">atomic</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="na">elements</span><span class="p">:</span> <span class="p">[</span>
            <span class="dl">"</span><span class="s2">lastNameCanonical</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">firstNameCanonical</span><span class="dl">"</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">created</span><span class="dl">"</span><span class="p">,</span>
          <span class="p">],</span>
        <span class="p">},</span>
        <span class="na">userBeneficiaryHashKey</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">atomic</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="na">elements</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">beneficiaryId</span><span class="dl">"</span><span class="p">],</span>
          <span class="na">sharded</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="na">userHashKey</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">atomic</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="na">elements</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">userId</span><span class="dl">"</span><span class="p">],</span>
          <span class="na">sharded</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
      <span class="na">indexes</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">created</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">hashKey</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rangeKey</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">created</span><span class="dl">"</span><span class="p">],</span>
        <span class="na">firstName</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">hashKey</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rangeKey</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">firstNameRangeKey</span><span class="dl">"</span><span class="p">],</span>
        <span class="na">lastName</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">hashKey</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rangeKey</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">lastNameRangeKey</span><span class="dl">"</span><span class="p">],</span>
        <span class="na">phone</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">hashKey</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rangeKey</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">phone</span><span class="dl">"</span><span class="p">],</span>
        <span class="na">updated</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">hashKey</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rangeKey</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">updated</span><span class="dl">"</span><span class="p">],</span>
        <span class="na">userBeneficiaryCreated</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">"</span><span class="s2">hashKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">rangeKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">userBeneficiaryHashKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">created</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="na">userBeneficiaryFirstName</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">"</span><span class="s2">hashKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">rangeKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">userBeneficiaryHashKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">firstNameRangeKey</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="na">userBeneficiaryLastName</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">"</span><span class="s2">hashKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">rangeKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">userBeneficiaryHashKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">lastNameRangeKey</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="na">userBeneficiaryPhone</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">"</span><span class="s2">hashKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">rangeKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">userBeneficiaryHashKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">phone</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="na">userBeneficiaryUpdated</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">"</span><span class="s2">hashKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">rangeKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">userBeneficiaryHashKey</span><span class="dl">"</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">updated</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">],</span>
      <span class="p">},</span>
      <span class="na">elementTranscodes</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">beneficiaryId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">created</span><span class="p">:</span> <span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">firstNameCanonical</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">lastNameCanonical</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">phone</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">updated</span><span class="p">:</span> <span class="dl">"</span><span class="s2">timestamp</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">userId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="c1">// Configure &amp; export EntityManager instance.</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">entityManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EntityManager</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">errorLogger</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="item-types">Item Types</h3>

<p>The <code class="language-plaintext highlighter-rouge">Email</code> and <code class="language-plaintext highlighter-rouge">User</code> interfaces defined above are not useful for database operations because…</p>

<ul>
  <li>
    <p>they don’t include the <code class="language-plaintext highlighter-rouge">hashKey</code> and <code class="language-plaintext highlighter-rouge">rangeKey</code> properties that we specified in our <strong>Entity Manager</strong> <code class="language-plaintext highlighter-rouge">config</code> object, and</p>
  </li>
  <li>
    <p>their generated properties all have a <code class="language-plaintext highlighter-rouge">never</code> type.</p>
  </li>
</ul>

<p>The <a href="http://localhost:4000/projects/entity-manager/configuration/#the-itemmap-type"><code class="language-plaintext highlighter-rouge">ItemMap</code></a> type takes our <code class="language-plaintext highlighter-rouge">EntityMap</code> type as a parameter and returns a map of the correct item types. Let’s do this and export the result for use in our endpoint handlers.</p>

<p>Visit <a href="https://github.com/karmaniverous/entity-manager-demo/blob/main/src/entityManager.ts"><code class="language-plaintext highlighter-rouge">entityManager.ts</code></a> to see this code in context.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="kd">type</span> <span class="p">{</span> <span class="nx">ItemMap</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@karmaniverous/entity-manager</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// Construct ItemMap type from MyEntityMap.</span>
<span class="kd">type</span> <span class="nx">MyItemMap</span> <span class="o">=</span> <span class="nx">ItemMap</span><span class="o">&lt;</span><span class="nx">MyEntityMap</span><span class="o">&gt;</span><span class="p">;</span>

<span class="c1">// Export EmailItem &amp; UserItem types for use in other modules.</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">EmailItem</span> <span class="o">=</span> <span class="nx">MyItemMap</span><span class="p">[</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">];</span>
<span class="k">export</span> <span class="kd">type</span> <span class="nx">UserItem</span> <span class="o">=</span> <span class="nx">MyItemMap</span><span class="p">[</span><span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">];</span>
</code></pre></div></div>

<h2 id="entityclient-configuration"><code class="language-plaintext highlighter-rouge">EntityClient</code> Configuration</h2>

<figure class=""><img src="https://raw.githubusercontent.com/karmaniverous/entity-manager-demo/main/assets/entityClient.png" alt="" /><figcaption>
      <em><code class="language-plaintext highlighter-rouge">EntityClient</code> configuration.</em>

    </figcaption></figure>

<p>The <a href="https://docs.karmanivero.us/entity-client-dynamodb/classes/index.EntityClient.html"><code class="language-plaintext highlighter-rouge">EntityClient</code></a> class combines the <a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/client/dynamodb/"><code class="language-plaintext highlighter-rouge">DynamoDBClient</code></a> and <a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/Package/-aws-sdk-lib-dynamodb/Class/DynamoDBDocument/"><code class="language-plaintext highlighter-rouge">DynamoDBDocument</code></a> classes from the AWS SDK with some higher-level functions to provide a simplified interface over key interactions with a DynamoDB database, as well as improved handling of batch operations.</p>

<p>For example:</p>

<ul>
  <li>
    <p>The <a href="https://docs.karmanivero.us/entity-client-dynamodb/classes/index.EntityClient.html#createTable"><code class="language-plaintext highlighter-rouge">createTable</code></a> method leverages its internal <code class="language-plaintext highlighter-rouge">DynamoDBClient</code> instance to create a table, then calls <a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/Package/-aws-sdk-client-dynamodb/Variable/waitUntilTableExists"><code class="language-plaintext highlighter-rouge">waitUntilTableExists</code></a> to block further execution until the new table is actually available for data operations.</p>
  </li>
  <li>
    <p>The <a href="https://docs.karmanivero.us/entity-client-dynamodb/classes/index.EntityClient.html#putItems"><code class="language-plaintext highlighter-rouge">putItems</code></a> method breaks an array of entity items into multiple batches, then leverages the <code class="language-plaintext highlighter-rouge">DynamoDBDocument</code> <a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/Package/-aws-sdk-lib-dynamodb/Class/BatchWriteCommand/"><code class="language-plaintext highlighter-rouge">BatchWriteCommand</code></a> to perform throttled batched writes to the database in parallel.</p>
  </li>
</ul>

<p>The class also provides direct access to the underlying <code class="language-plaintext highlighter-rouge">DynamoDBClient</code> and <code class="language-plaintext highlighter-rouge">DynamoDBDocument</code> instances, so any operations not supported by enhanced <code class="language-plaintext highlighter-rouge">EntityClient</code> methods are also available. This demo will provide examples of both modes of operation.</p>

<p>See the <a href="https://github.com/karmaniverous/entity-client-dynamodb"><code class="language-plaintext highlighter-rouge">entity-client-dynamodb</code></a> repository for more info.</p>

<p>As with the <a href="#entitymanager-configuration"><code class="language-plaintext highlighter-rouge">EntityManager</code> instance configuration</a> above, we have injected an <code class="language-plaintext highlighter-rouge">errorLogger</code> object that proxies <code class="language-plaintext highlighter-rouge">console</code> to disable debug logging in the <code class="language-plaintext highlighter-rouge">EntityClient</code> instance while keeping it enabled elsewhere. See my <a href="https://github.com/karmaniverous/controlled-proxy"><code class="language-plaintext highlighter-rouge">controlled-proxy</code></a> repo for more info!</p>

<p>Otherwise, the <a href="https://docs.karmanivero.us/entity-client-dynamodb/interfaces/index.EntityClientOptions.html"><code class="language-plaintext highlighter-rouge">EntityClientOptions</code></a> type is only a slight extension of the familiar <a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/Package/-aws-sdk-client-dynamodb/Interface/DynamoDBClientConfig"><code class="language-plaintext highlighter-rouge">DynamoDBClientConfig</code></a> type, so configuring the <code class="language-plaintext highlighter-rouge">EntityClient</code> instance for this demo is straightforward.</p>

<p>Visit <a href="https://github.com/karmaniverous/entity-manager-demo/blob/main/src/entityClient.ts"><code class="language-plaintext highlighter-rouge">entityClient.ts</code></a> to see this code in context.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">EntityClient</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@karmaniverous/entity-client-dynamodb</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">errorLogger</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./logger</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">entityClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EntityClient</span><span class="p">({</span>
  <span class="na">credentials</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">accessKeyId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fakeAccessKeyId</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">secretAccessKey</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fakeSecretAccessKey</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">endpoint</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://localhost:8000</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">logger</span><span class="p">:</span> <span class="nx">errorLogger</span><span class="p">,</span>
  <span class="na">region</span><span class="p">:</span> <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="endpoint-handlers">Endpoint Handlers</h2>

<figure class=""><img src="https://raw.githubusercontent.com/karmaniverous/entity-manager-demo/main/assets/handler.png" alt="" /><figcaption>
      <em>CRUD &amp; search handler structure.</em>

    </figcaption></figure>

<p>Every handler function defined below follows the pattern illustrated in the diagram above. Here’s a breakdown of the key elements in the diagram:</p>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">User</code></strong> is the type used in your application to represent a User object, not including all the generated properties used by <strong>Entity Manager</strong> to support database operations. Depending on handler requirements, <code class="language-plaintext highlighter-rouge">Email</code> is also available.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">params</code></strong> are the parameters received by the <code class="language-plaintext highlighter-rouge">handler</code> function. In most cases this object’s type will be some variant on the <code class="language-plaintext highlighter-rouge">User</code> or <code class="language-plaintext highlighter-rouge">Email</code> type.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">UserItem</code></strong> is the complete User type stored in the database, including all generated properties specified in the <code class="language-plaintext highlighter-rouge">EntityManager</code> <a href="https://docs.karmanivero.us/entity-manager/types/entity_manager.ParsedConfig.html">configuration</a>. Depending on handler requirements, <code class="language-plaintext highlighter-rouge">EmailItem</code> is also available.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">handler</code></strong> is the function that handles the actual data request. As we will see below, with <strong>Entity Manager</strong> in place this code can be <em>very</em> compact and efficient! Internally, the <code class="language-plaintext highlighter-rouge">handler</code> function will use the <code class="language-plaintext highlighter-rouge">UserItem</code> and <code class="language-plaintext highlighter-rouge">EmailItem</code> types to interact with the database.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">entityManager</code></strong> is an instance of the <a href="https://docs.karmanivero.us/entity-manager/classes/entity_manager.EntityManager.html"><code class="language-plaintext highlighter-rouge">EntityManager</code></a> class, which is initialized with a configuration reflecting the design summarized <a href="/projects/entity-manager/evolving-a-nosql-db-schema/#recap">here</a>. This object gives our handler the ability to add and remove generated properties from a <code class="language-plaintext highlighter-rouge">UserItem</code> or <code class="language-plaintext highlighter-rouge">EmailItem</code> and to perform query and CRUD operations on these entities in the database.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">entityClient</code></strong> is an instance of the DynamoDB-specific <a href="https://docs.karmanivero.us/entity-client-dynamodb/classes/index.EntityClient.html"><code class="language-plaintext highlighter-rouge">EntityClient</code></a> class, initialized to connect with the User Service table in DynamoDB. In principle we could accomplish everything in this demo using <a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/client/dynamodb/"><code class="language-plaintext highlighter-rouge">DynamoDBClient</code></a> and <a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/Package/-aws-sdk-lib-dynamodb/Class/DynamoDBDocument/"><code class="language-plaintext highlighter-rouge">DynamoDBDocument</code></a> from the native DynamoDB SDK, but the <code class="language-plaintext highlighter-rouge">EntityClient</code> class simplifies database interactions and eliminates a lot of noise that would otherwise interfere with the clarity of this demo. We’ll also use a utility function from the same library to generate our DynamoDB table definition from our <strong>Entity Manager</strong> config!</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">shardQueryMapBuilder</code></strong> is a <a href="https://docs.karmanivero.us/entity-client-dynamodb/classes/index.QueryBuilder.html"><code class="language-plaintext highlighter-rouge">ShardQueryMapBuilder</code></a> instance declared internally by handler functions (like search endpoints) that require the ability to perform cross-shard, multi-index database queries. Each instance is handler-specific, so this object is not shared between handlers.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">logger</code></strong> is simply an alias of <code class="language-plaintext highlighter-rouge">console</code>. Feel free to replace it with your favorite logger!</p>
  </li>
</ul>

<h3 id="email-entity">Email Entity</h3>

<figure class=""><img src="https://raw.githubusercontent.com/karmaniverous/entity-manager-demo/main/assets/email-types.png" alt="" /><figcaption>
      <em>Email entity types.</em>

    </figcaption></figure>

<h4 id="create-email">Create Email</h4>

<p>TODO</p>

<h4 id="read-email">Read Email</h4>

<p>TODO</p>

<h4 id="delete-email">Delete Email</h4>

<p>TODO</p>

<h4 id="search-emails">Search Emails</h4>

<p>TODO</p>

<h3 id="user-entity">User Entity</h3>

<figure class=""><img src="https://raw.githubusercontent.com/karmaniverous/entity-manager-demo/main/assets/user-types.png" alt="" /><figcaption>
      <em>User entity types.</em>

    </figcaption></figure>

<h4 id="create-user">Create User</h4>

<p>TODO</p>

<h4 id="read-user">Read User</h4>

<p>TODO</p>

<h4 id="update-user">Update User</h4>

<p>TODO</p>

<h4 id="delete-user">Delete User</h4>

<p>TODO</p>

<h4 id="search-users">Search Users</h4>

<p>TODO</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Topics: </strong>
    <span itemprop="keywords">
    
      <a href="/topics/aws" class="page__taxonomy-item p-category" rel="tag">aws</a><span class="sep">, </span>
    
      <a href="/topics/dynamodb" class="page__taxonomy-item p-category" rel="tag">dynamodb</a><span class="sep">, </span>
    
      <a href="/topics/entity-manager" class="page__taxonomy-item p-category" rel="tag">entity-manager</a><span class="sep">, </span>
    
      <a href="/topics/logging" class="page__taxonomy-item p-category" rel="tag">logging</a><span class="sep">, </span>
    
      <a href="/topics/nosql" class="page__taxonomy-item p-category" rel="tag">nosql</a><span class="sep">, </span>
    
      <a href="/topics/projects" class="page__taxonomy-item p-category" rel="tag">projects</a><span class="sep">, </span>
    
      <a href="/topics/typescript" class="page__taxonomy-item p-category" rel="tag">typescript</a>
    
    </span>
  </p>




        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2024-11-21T02:10:13+00:00">November 21, 2024</time></p>

      </footer>

      
        <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=karmaniverous&text=Entity+Manager%3A+A+Demonstration%20https%3A%2F%2Fkarmanivero.us%2Fprojects%2Fentity-manager%2Fdemo%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fkarmanivero.us%2Fprojects%2Fentity-manager%2Fdemo%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://karmanivero.us/projects/entity-manager/demo/" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/projects/entity-manager/evolving-a-nosql-db-schema/" class="pagination--pager" title="Evolving a NoSQL Database Schema
">Previous</a>
    
    
      <a href="/projects/entity-manager/configuration/" class="pagination--pager" title="Entity Manager Configuration
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    




















  



  
  

  
  

  
  

  
  <div class='page__related'>
    
    <h2 class='page__related-title'>
      You may also enjoy
    </h2>
    <div class='grid__wrapper'>

      
      
        
        
        
        
        
        
      

        
      

        
        <!-- post_url: /the-big-miss-turning-lemons-into-lemonade/ -->
        <!-- normLogCommonTags: 0.8888888888888888 -->
        <!-- logAge: 0.0905092592592593 -->
        <!-- relevance: 52576 -->

        
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/lemons-square.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/the-big-miss-turning-lemons-into-lemonade/" rel="permalink">The Big Miss: Turning Lemons Into Lemonade
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i
          class="far fa-fw fa-calendar-alt"
          aria-hidden="true"
        ></i>
        
        <time datetime="2024-11-20T00:00:00+00:00">November 20, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-fw fa-clock"
          aria-hidden="true"
        ></i>
        
          8
          minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Today was one of those days when I question my life choices. Watch me dig my way out of a hole with the same shovel I used to dig my way in.
</p>
  </article>
</div>


        
        
        
      
        
        
        
        
        
      

        
      

        
        <!-- post_url: /composition-in-action-finishing-the-swing/ -->
        <!-- normLogCommonTags: 0.8888888888888888 -->
        <!-- logAge: 5.1278284143518515 -->
        <!-- relevance: 47539 -->

        
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="https://github.com/karmaniverous/controlled-proxy/raw/main/assets/controlled-proxy-square.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/composition-in-action-finishing-the-swing/" rel="permalink">Composition in Action: Finishing the Swing
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i
          class="far fa-fw fa-calendar-alt"
          aria-hidden="true"
        ></i>
        
        <time datetime="2024-10-16T00:00:00+00:00">October 16, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-fw fa-clock"
          aria-hidden="true"
        ></i>
        
          9
          minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In software engineering, what look to be the easy parts often turn out to be the hard parts. If you’re lucky, the reverse is also true, but don’t count on it.
</p>
  </article>
</div>


        
        
        
      
        
        
        
        
        
      

        
      

        
        <!-- post_url: /mixin-it-up-picking-the-right-problem-to-solve/ -->
        <!-- normLogCommonTags: 0.8888888888888888 -->
        <!-- logAge: 5.2528284143518515 -->
        <!-- relevance: 47414 -->

        
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/mixin-it-up-square.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/mixin-it-up-picking-the-right-problem-to-solve/" rel="permalink">Mixin It Up: Picking The Right Problem to Solve
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i
          class="far fa-fw fa-calendar-alt"
          aria-hidden="true"
        ></i>
        
        <time datetime="2024-10-12T00:00:00+00:00">October 12, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-fw fa-clock"
          aria-hidden="true"
        ></i>
        
          9
          minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Sometimes, when you’re tangled up in a thorny problem, solving it is exactly the wrong answer.
</p>
  </article>
</div>


        
        
        
      
        
        
        
        
        
      

        
      

        
        <!-- post_url: /loggable-a-typescript-mixin-for-generic-class-logging/ -->
        <!-- normLogCommonTags: 0.8888888888888888 -->
        <!-- logAge: 5.2840784143518515 -->
        <!-- relevance: 47383 -->

        
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="https://raw.githubusercontent.com/karmaniverous/loggable/main/assets/loggable-square.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/loggable-a-typescript-mixin-for-generic-class-logging/" rel="permalink">Loggable: A TypeScript Mixin for Generic Class Logging
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i
          class="far fa-fw fa-calendar-alt"
          aria-hidden="true"
        ></i>
        
        <time datetime="2024-10-11T00:00:00+00:00">October 11, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-fw fa-clock"
          aria-hidden="true"
        ></i>
        
          5
          minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Logging is an implementation decision that should be deferred as late as possible. Loggable lets you defer it until runtime!
</p>
  </article>
</div>


        
        
        
      
        
        
        
        
        
      

        
      

        
        <!-- post_url: /code-complete-a-day-in-the-life-of-a-product/ -->
        <!-- normLogCommonTags: 1.0 -->
        <!-- logAge: 6.017039207175926 -->
        <!-- relevance: 46983 -->

        
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/code-complete-tests.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/code-complete-a-day-in-the-life-of-a-product/" rel="permalink">Code Complete: A Day in the Life of a Product
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i
          class="far fa-fw fa-calendar-alt"
          aria-hidden="true"
        ></i>
        
        <time datetime="2024-09-17T00:00:00+00:00">September 17, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-fw fa-clock"
          aria-hidden="true"
        ></i>
        
          8
          minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">We’re all professionals here, right? And we all know there’s often quite a gap between what gets posted to social media and the reality on the ground.
</p>
  </article>
</div>


        
        
        
      
        
        
        
        
        
      

        
      

        
        <!-- post_url: /mock-db/ -->
        <!-- normLogCommonTags: 1.0 -->
        <!-- logAge: 6.251414207175926 -->
        <!-- relevance: 46749 -->

        
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/logo-mock-db.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/mock-db/" rel="permalink">mock-db
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i
          class="far fa-fw fa-calendar-alt"
          aria-hidden="true"
        ></i>
        
        <time datetime="2024-09-02T00:00:00+00:00">September 2, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-fw fa-clock"
          aria-hidden="true"
        ></i>
        
          1
          minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Mock DynamoDB-style query &amp; scan behavior with local JSON data. Or learn to play the guitar, if you think pretty girls REALLY like that kind of thing.
</p>
  </article>
</div>


        
        
        
      
        
        
        
        
        
      

        
      

        
        <!-- post_url: /what-good-looks-like-a-real-world-typescript-refactor/ -->
        <!-- normLogCommonTags: 0.6666666666666666 -->
        <!-- logAge: 6.188914207175926 -->
        <!-- relevance: 45811 -->

        
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/what-good-looks-like-square.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/what-good-looks-like-a-real-world-typescript-refactor/" rel="permalink">What Good Looks Like: A Real-World Typescript Refactor
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i
          class="far fa-fw fa-calendar-alt"
          aria-hidden="true"
        ></i>
        
        <time datetime="2024-09-06T00:00:00+00:00">September 6, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-fw fa-clock"
          aria-hidden="true"
        ></i>
        
          6
          minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Watch a complex Javascript configuration object collapse into declarative goodness thanks to type safety, abstraction, and generic design.
</p>
  </article>
</div>


        
        
        
      
        
        
        
        
        
      

        
      

        
        <!-- post_url: /generic-abstractions/ -->
        <!-- normLogCommonTags: 0.6666666666666666 -->
        <!-- logAge: 6.188914207175926 -->
        <!-- relevance: 45811 -->

        
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/generic-abstractions.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/generic-abstractions/" rel="permalink">Generic Abstractions
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i
          class="far fa-fw fa-calendar-alt"
          aria-hidden="true"
        ></i>
        
        <time datetime="2024-09-06T00:00:00+00:00">September 6, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-fw fa-clock"
          aria-hidden="true"
        ></i>
        
          14
          minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Modern software development works just like any other Hero’s Journey: you’ve got to hoof it some ways down the road before you can see very far into the dist...</p>
  </article>
</div>


        
        
        
          
    </div>
  </div>

  
</div>
      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form onsubmit="return googleCustomSearchExecute();" id="cse-search-box-form-id" role="search">
    <label class="sr-only" for="cse-search-input-box-id">
      Enter your search term...
    </label>
    <input type="search" id="cse-search-input-box-id" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results">
    <gcse:searchresults-only></gcse:searchresults-only>
  </div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  
    <span class="love">Built for you with ❤️ on <a href="/bali/">Bali</a>!</span>
  

  <ul class="social-icons">
    
      <li>
        <strong>Contact</strong>&nbsp;&nbsp;&nbsp;</li>
    

    
      
        
          <li>
            <a href="https://twitter.com/karmaniverous" rel="nofollow noopener noreferrer">
              <i class="fa-brands fa-x-twitter" aria-hidden="true"></i>
              </a>
          </li>
        
      
        
          <li>
            <a href="https://techhub.social/@karmaniverous" rel="nofollow noopener noreferrer">
              <i class="fa-brands fa-mastodon" aria-hidden="true"></i>
              </a>
          </li>
        
      
        
          <li>
            <a href="https://github.com/karmaniverous" rel="nofollow noopener noreferrer">
              <i class="fa-brands fa-github" aria-hidden="true"></i>
              </a>
          </li>
        
      
        
          <li>
            <a href="https://www.linkedin.com/in/jscroft/" rel="nofollow noopener noreferrer">
              <i class="fa-brands fa-linkedin" aria-hidden="true"></i>
              </a>
          </li>
        
      
        
          <li>
            <a href="https://wa.me/17737500338" rel="nofollow noopener noreferrer">
              <i class="fa-brands fa-square-whatsapp" aria-hidden="true"></i>
              </a>
          </li>
        
      
        
          <li>
            <a href="https://t.me/karmaniverous" rel="nofollow noopener noreferrer">
              <i class="fa-brands fa-telegram" aria-hidden="true"></i>
              </a>
          </li>
        
      
        
          <li>
            <a href="https://calendly.com/karmaniverous" rel="nofollow noopener noreferrer">
              <i class="fa-regular fa-calendar-plus" aria-hidden="true"></i>
              </a>
          </li>
        
      
    

    
      <li>
        <a href="/feed.xml">
          <i class="fas fa-fw fa-rss-square" aria-hidden="true"></i>
           </a>
      </li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024
  <a href="https://karmanivero.us">some words</a>. Powered by
  <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a>
  &amp;
  <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>


<script>
  (function () {
    var cx = '960ee5d1b2fec4509';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();

  function googleCustomSearchExecute() {
    var input = document.getElementById('cse-search-input-box-id');
    var element = google.search.cse.element.getElement('searchresults-only0');
    if (input.value == '') {
      element.clearAllResults();
    } else {
      element.execute(input.value);
    }
    return false;
  }

  
    $(document).ready(function () {
      $('input#cse-search-input-box-id').on('keyup', function () {
        googleCustomSearchExecute();
      });
    });
  
</script>






  </body>
</html>
