<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Related Posts With Minimal Mistakes - some words</title>
<meta name="description" content="Presenting a radically improved related-posts widget for the Minimal Mistakes Jekyll theme.">


  <meta name="author" content="Jason Williscroft">
  
  <meta property="article:author" content="Jason Williscroft">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="some words">
<meta property="og:title" content="Related Posts With Minimal Mistakes">
<meta property="og:url" content="https://karmanivero.us/related-posts-with-minimal-mistakes/">


  <meta property="og:description" content="Presenting a radically improved related-posts widget for the Minimal Mistakes Jekyll theme.">



  <meta property="og:image" content="https://karmanivero.us/assets/images/related-posts-banner.jpg">



  <meta name="twitter:site" content="@karmaniverous">
  <meta name="twitter:title" content="Related Posts With Minimal Mistakes">
  <meta name="twitter:description" content="Presenting a radically improved related-posts widget for the Minimal Mistakes Jekyll theme.">
  <meta name="twitter:url" content="https://karmanivero.us/related-posts-with-minimal-mistakes/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://karmanivero.us/assets/images/related-posts-banner.jpg">
  

  



  <meta property="article:published_time" content="2024-11-16T00:00:00+00:00">






<link rel="canonical" href="https://karmanivero.us/related-posts-with-minimal-mistakes/">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="some words Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="text/javascript">
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  window.enable_copy_code_button = true;
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <link
  rel="apple-touch-icon"
  sizes="180x180"
  href="/assets/favicon/apple-touch-icon.png" />
<link
  rel="icon"
  type="image/png"
  sizes="32x32"
  href="/assets/favicon/favicon-32x32.png" />
<link
  rel="icon"
  type="image/png"
  sizes="16x16"
  href="/assets/favicon/favicon-16x16.png" />
<link rel="manifest" href="/assets/favicon/site.webmanifest" />
<link
  rel="mask-icon"
  href="/assets/favicon/safari-pinned-tab.svg"
  color="#5bbad5" />
<link rel="shortcut icon" href="/assets/favicon/favicon.ico" />
<meta name="msapplication-TileColor" content="#2b5797" />
<meta name="msapplication-config" content="/assets/favicon/browserconfig.xml" />
<meta name="theme-color" content="#ffffff" />



<!-- Mathjax Support -->
<script
  type="text/javascript"
  async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          some words
          <span class="site-subtitle">many of them true</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/projects/"
                
                
              >Projects</a>
            </li><li class="masthead__menu-item">
              <a
                href="/toolkits/"
                
                
              >Toolkits</a>
            </li><li class="masthead__menu-item">
              <a
                href="/bali/"
                
                
              >Bali</a>
            </li><li class="masthead__menu-item">
              <a
                href="/topics/"
                
                
              >Topics</a>
            </li><li class="masthead__menu-item">
              <a
                href="/blog/"
                
                
              >Archive</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://karmanivero.us/">
        <img src="/assets/images/bio-photo.jpg" alt="Jason Williscroft" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://karmanivero.us/" itemprop="url">Jason Williscroft</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p><em>resume bullets<br />may read differently at the<br />threshold of heaven</em></p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Contact</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="https://twitter.com/karmaniverous" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fa-brands fa-square-x-twitter" aria-hidden="true"></i><span class="label">X</span></a></li>
          
        
          
            <li><a href="https://techhub.social/@karmaniverous" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fa-brands fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span></a></li>
          
        
          
            <li><a href="https://github.com/karmaniverous" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fa-brands fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/jscroft/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fa-brands fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://wa.me/17737500338" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fa-brands fa-whatsapp" aria-hidden="true"></i><span class="label">WhatsApp</span></a></li>
          
        
          
            <li><a href="https://t.me/karmaniverous" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fa-brands fa-telegram" aria-hidden="true"></i><span class="label">Telegram</span></a></li>
          
        
          
            <li><a href="https://calendly.com/karmaniverous" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fa-regular fa-calendar-plus" aria-hidden="true"></i><span class="label">Meet</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article
    class="page"
    itemscope
    itemtype="https://schema.org/CreativeWork"
    >
    <meta itemprop="headline" content="Related Posts With Minimal Mistakes">
    <meta itemprop="description" content="Presenting a radically improved related-posts widget for the Minimal Mistakes Jekyll theme.">
    <meta itemprop="datePublished" content="2024-11-16T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1
              id="page-title"
              class="page__title"
              itemprop="headline">
              <a href="https://karmanivero.us/related-posts-with-minimal-mistakes/" itemprop="url">Related Posts With Minimal Mistakes
</a>
            </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i
          class="far fa-calendar-alt"
          aria-hidden="true"
        ></i>
        
        <time datetime="2024-11-16T00:00:00+00:00">November 16, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-clock"
          aria-hidden="true"
        ></i>
        
          15
          minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header>
                <h4 class="nav__title">
                  <i class="fas fa-file-alt"></i>
                  On this page</h4>
              </header>
              <ul class="toc__menu"><li><a href="#jekyll-in-a-nutshell">Jekyll in a Nutshell</a></li><li><a href="#related-content-what-good-looks-like">Related Content: What Good Looks Like</a></li><li><a href="#whats-actually-in-the-box">What’s Actually In The Box</a></li><li><a href="#an-improved-alternative">An Improved Alternative</a></li><li><a href="#calculating-relevance">Calculating Relevance</a></li><li><a href="#liquid-logs">Liquid Logs</a></li><li><a href="#putting-it-all-together">Putting It All Together</a></li><li><a href="#cleaning-up">Cleaning Up</a></li><li><a href="#conclusion">Conclusion</a></li></ul>
            </nav>
          </aside>
        
        <figure class="align-left drop-image">
    <img src="/assets/images/related-posts-square.jpg" />
</figure>

<p>As I publish more and more content, I am increasingly concerned about connecting the dots between the post you are now reading and other, related posts. Just like every other blog in the world, I use a <em>Related Posts</em> section at the bottom of each page for that purpose.</p>

<p class="notice--info"><strong>TL/DR:</strong> See the list of related posts at the bottom of this page. That’s what we’re building here.</p>

<h2 id="jekyll-in-a-nutshell">Jekyll in a Nutshell</h2>

<p>This site is a <a href="https://jekyllrb.com/">Jekyll</a> instance, based on the very excellent <a href="https://github.com/mmistakes/minimal-mistakes">Minimal Mistakes</a> theme and hosted on <a href="https://pages.github.com/">GitHub Pages</a>. As a matter of expediency, I’m using the <a href="https://mmistakes.github.io/minimal-mistakes/docs/quick-start-guide/#remote-theme-method">remote version</a> of the theme, which reduces the complexity a bit but limits the Jekyll plugins I can use.</p>

<p>Content items in Jekyll break down into two broad categories: <a href="https://jekyllrb.com/docs/pages/">pages</a> and <a href="https://jekyllrb.com/docs/posts/">posts</a>. Pages lay out the broad structure of the site (like your About or Portfolio page, although your Home page can be a special case). Posts are the individual articles you write. Think of a post as <em>dated</em> content, while a page is <em>evergreen</em> content.</p>

<p>Posts are grouped into <a href="https://jekyllrb.com/docs/collections/">collections</a>, each under its own root path. For example, on this site, all blog posts are under the <a href="/blog"><code class="language-plaintext highlighter-rouge">/blog</code></a> path, and the Entity Manager documentation is collected under the <a href="/projects/entity-manager"><code class="language-plaintext highlighter-rouge">/projects/entity-manager</code></a> path. Each collection also defines its own taxonomic &amp; layout defaults, so it’s easy to create a common look and feel for all the posts in a collection.</p>

<p>Jekyll supports the assignment of <a href="https://jekyllrb.com/docs/posts/#tags-and-categories">tags and categories</a> to any post or page. Most themes have special layouts that leverage these taxonomies to create tag and category indexes like <a href="/topics">this one</a>.</p>

<p>Every post or page can have <a href="https://jekyllrb.com/docs/front-matter/">front matter</a>. This is a block of YAML at the top of the file that defines its tags, categories, title, layout, and other metadata, and also sets variables that can be consumed by the theme to do things like toggling the display of a table of contents or—today’s topic—<strong>related content</strong>.</p>

<h2 id="related-content-what-good-looks-like">Related Content: What Good Looks Like</h2>

<p>So when you look for related content at the bottom of a post or page, what should you actually see? Here’s a list of requirements:</p>

<ul>
  <li>
    <p>The related content should be <strong>relevant</strong> to the post or page you are reading. We ought to be able to leverage common tags to determine relevance (let’s leave categories out of this discussion; the principle is the same).</p>
  </li>
  <li>
    <p>The related content should be <strong>prioritized</strong>. Content that is newer and/or more relevant should appear higher in the list.</p>
  </li>
  <li>
    <p>The related content should be <strong>limited</strong>. I should only see the top few <em>most</em> relevant items, not every post that shares a tag with the one I’m reading.</p>
  </li>
  <li>
    <p>The related content should be <strong>type-independent</strong>. A page or a post should be able to relate to a another page or a post in a different collection if they have at least one tag in common.</p>
  </li>
  <li>
    <p>The related content should be <strong>rational</strong>. I shouldn’t see hidden posts. Unless this page is a blog post, I shouldn’t see other posts from the same collection. If a post redirects to a page, the redirecting post shouldn’t appear in the list… but if the redirecting post has tags assigned to it, then they should factor into the redirection target’s relevance score!</p>
  </li>
</ul>

<h2 id="whats-actually-in-the-box">What’s Actually In The Box</h2>

<p>The good news is that the Minimal Mistakes theme actually has a <a href="https://github.com/mmistakes/minimal-mistakes/blob/master/_includes/page__related.html">related posts include</a> built in. If you set <code class="language-plaintext highlighter-rouge">related_posts: true</code> in your post’s front matter, the include will generate a list of related posts at the bottom of the rendered page.</p>

<p>The bad news is that this widget is pretty basic. All it <em>really</em> does is display the most recent posts in your timeline: the same ones on every page, with no respect to actual relevance.</p>

<p>To the author’s credit, he’s aware of the gap. There’s a <a href="https://github.com/mmistakes/minimal-mistakes/issues/554">closed issue</a> in the Minimal Mistakes repo that addresses the problem, and the author published <a href="https://github.com/mmistakes/minimal-mistakes/issues/554#issuecomment-302143467">a solution</a> that addresses it.</p>

<p>But…</p>

<ul>
  <li>
    <p>This solution doesn’t do any of the relevance scoring or sorting described above, and it won’t be included in the official theme due to the author’s concerns about build performance. Which is fair.</p>
  </li>
  <li>
    <p>Relevant posts in this solution are all constrained to the posts collection. It won’t show pages or posts from other collections, and it also won’t filter out redirected posts.</p>
  </li>
</ul>

<p>So probably not the solution I’m looking for.</p>

<p class="notice--info"><strong>This file is a <a href="https://shopify.github.io/liquid/">Liquid</a> include!</strong> So anything we build here will be a drop-in replacement for the existing include, also implemented in Liquid.</p>

<p>Let’s get to work.</p>

<h2 id="an-improved-alternative">An Improved Alternative</h2>

<p><a href="https://blog.webjeda.com/jekyll-related-posts/">This post</a> (H/T <a href="https://www.fabriziomusacchio.com/">Fabrizio Musacchio</a> and his excellent <a href="https://www.fabriziomusacchio.com/blog/2021-08-11-Minimal_Mistakes_Cheat_Sheet/">Minimal Mistakes Cheat Sheet</a>) outlines a strategy for scoring related posts based on the number of tags they have in common.</p>

<p>It’s an improvement over the Minimal Mistakes solution, but…</p>

<ul>
  <li>
    <p>it isn’t specific to the Minimal Mistakes theme,</p>
  </li>
  <li>
    <p>it still doesn’t support pages or non-blog posts, and</p>
  </li>
  <li>
    <p>it doesn’t factor in recency or redirects.</p>
  </li>
</ul>

<p>But it got my creative juices flowing. So yesterday I rolled up my sleeves and went to work.</p>

<h2 id="calculating-relevance">Calculating Relevance</h2>

<p>Let’s say that there are two factors to calculating relevance \(R\):</p>

<ul>
  <li>
    <p>The number of tags \(N\) a given post has in common with the current page.</p>
  </li>
  <li>
    <p>The age in days \(A\) of the post.</p>
  </li>
</ul>

<p>Let’s take the log of both of these values, since the difference between today’s post and yesterday’s post should count for more than that between a year-old post and one aged a year and a day. Same argument applies for common tag counts.</p>

<p>Let’s use a base-2 log as it will be a little easier to implement in Liquid.</p>

<p>Let’s weight the contribution of \(N\) by \(W_{tags}\), and normalize \(N\) by the maximum number \(N_{max}\) of common tags across all posts so we don’t need to change \(W_{tags}\) as we add new tags to our system.</p>

<p>Then we have:</p>

\[R = W_{tags} \ log_2 \dfrac{N}{N_{max}} - log_2 A\]

<p>Pages don’t have a post date, so calculating their age is problematic. There are plugins that will get the last-modified date of a file, but…</p>

<ul>
  <li>
    <p>None of them are white-listed for GitHub Pages, so they won’t work with the remote version of the Minimal Mistakes theme.</p>
  </li>
  <li>
    <p>None of them perform very well anyway.</p>
  </li>
  <li>
    <p>Pages are generally evergreen content, so they <em>should</em> be treated as fairly recent, regardless when last modified.</p>
  </li>
</ul>

<p>Easy solution: let’s give all pages a default age of 32 days. That way they’ll have a high calculated relevance, but recent posts can still compete with them on tag relevance.</p>

<p>As calculated above, \(R\) will have a small value in the one-to-two-digit range, centered around zero. To get it to work with a text-based Liquid sort, we’ll need to scale it up, add a big number, and round it off so it has a constant width. We’ll handle that in the code.</p>

<h2 id="liquid-logs">Liquid Logs</h2>

<p>Liquid has no native support for a log function, so let’s get that out of the way first.</p>

<p>There are a couple of different ways to do this, but we’re going to pick an easy, brute-force approach: we’re going to look up the nearest whole-number answers and then interpolate between them. This will be accurate enough for our purposes and will execute very fast, which is good, since we’ll need to do it a <em>lot</em>.</p>

<p>Create this file at <code class="language-plaintext highlighter-rouge">_includes/log2.html</code>:</p>

<div class="language-liquid highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">include</span><span class="p">.</span><span class="nv">value</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">%}</span>

<span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">elsif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">elsif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">divided_by</span><span class="p">:</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">elsif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">divided_by</span><span class="p">:</span><span class="w"> </span><span class="mf">4.0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">elsif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">divided_by</span><span class="p">:</span><span class="w"> </span><span class="mf">8.0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">elsif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">divided_by</span><span class="p">:</span><span class="w"> </span><span class="mf">16.0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">elsif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">divided_by</span><span class="p">:</span><span class="w"> </span><span class="mf">32.0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">elsif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">divided_by</span><span class="p">:</span><span class="w"> </span><span class="mf">64.0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">elsif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">256</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">divided_by</span><span class="p">:</span><span class="w"> </span><span class="mf">128.0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">elsif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">512</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="mi">256</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">divided_by</span><span class="p">:</span><span class="w"> </span><span class="mf">256.0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">elsif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="mi">512</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">divided_by</span><span class="p">:</span><span class="w"> </span><span class="mf">512.0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">elsif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2048</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">divided_by</span><span class="p">:</span><span class="w"> </span><span class="mf">1024.0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">elsif</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="mi">2048</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">divided_by</span><span class="p">:</span><span class="w"> </span><span class="mf">2048.0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{{</span><span class="w"> </span><span class="mf">12.0</span><span class="w"> </span><span class="p">}}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
</code></pre></div></div>

<p>This will support meaningful relevance calculations for posts with up to 4,096 common tags and ages up to over 11 years. If you need more than that, you can add more <code class="language-plaintext highlighter-rouge">elsif</code> blocks.</p>

<p>To use this include, we’ll need to capture its output like this:</p>

<div class="language-liquid highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Assume ageInDays has some numerical value. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">capture</span><span class="w"> </span><span class="nv">logAge</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">include</span><span class="w"> </span>log2.html<span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="nv">ageInDays</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">endcapture</span><span class="w"> </span><span class="p">%}</span>

<span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Convert the resulting string back to a number. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">logAge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">logAge</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">times</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="p">%}</span>\
</code></pre></div></div>

<p>And yes, I am fully aware of how ugly that is. That’s Liquid for you! 🤷‍♂️</p>

<h2 id="putting-it-all-together">Putting It All Together</h2>

<p>Here is the replacement for <a href="https://github.com/mmistakes/minimal-mistakes/blob/master/_includes/page__related.html"><code class="language-plaintext highlighter-rouge">page__related.html</code></a> that implements everything described in <a href="#calculating-relevance">Calculating Relevance</a> above.</p>

<p>See the comments inline for details. Again, my apologies for the awkward layout &amp; syntax… even Shopify’s own code formatter can only do so much with Liquid!</p>

<p>Also note the constants at the top of the script. You can adjust these to suit your own needs.</p>

<div class="language-liquid highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Minimum number of tags a page needs in common with this one to be related. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">minCommonTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">%}</span>

<span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Relative weight given to common tags over post recency. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">commonTagsWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">%}</span>

<span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Pages don't have a post date. This is their default age (common tags will boost their relevance). </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">defaultAge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="p">%}</span>

<span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Maximum number of related pages to display. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">maxRelated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">%}</span>

<span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Get all pages &amp; collection posts (including blog posts) that are not from the current page's collection unless it is a blog post. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">posts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">site</span><span class="p">.</span><span class="nv">pages</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nv">collection</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nv">site.collections</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">pageCollection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">collection</span><span class="p">.</span><span class="nv">docs</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">where</span><span class="p">:</span><span class="w"> </span><span class="s1">'url'</span><span class="p">,</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">url</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">size</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="kr">unless</span><span class="w"> </span><span class="nv">pageCollection</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">collection</span><span class="p">.</span><span class="nv">label</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'posts'</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">posts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">posts</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">concat</span><span class="p">:</span><span class="w"> </span><span class="nv">collection</span><span class="p">.</span><span class="nv">docs</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="kr">endunless</span><span class="w"> </span><span class="p">%}{%</span><span class="w"> </span><span class="nt">endfor</span><span class="w"> </span><span class="p">%}</span>

<span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> We're going to log-scale &amp; normalize the common tag count, so we need to track its max value. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">maxLogCommonTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">%}</span>

<span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Iterate over these comparison pages &amp; capture the relevant ones. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">relevantPosts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">split</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">%}{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'now'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">date</span><span class="p">:</span><span class="w"> </span><span class="s1">'%s'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nv">post</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nv">posts</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Ignore the current page, hidden pages &amp; redirects. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="kr">unless</span><span class="w"> </span><span class="nv">post</span><span class="p">.</span><span class="nv">url</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">url</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">post</span><span class="p">.</span><span class="nv">hidden</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">post</span><span class="p">.</span><span class="nv">redirect_to</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Create a list of tags on the comparison page. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">post</span><span class="p">.</span><span class="nv">tags</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">uniq</span><span class="w"> </span><span class="p">%}</span>

    <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> If some post redirected to this page, include its tags too. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">sourcePost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">posts</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">where</span><span class="p">:</span><span class="w"> </span><span class="s1">'redirect_to'</span><span class="p">,</span><span class="w"> </span><span class="nv">post</span><span class="p">.</span><span class="nv">url</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">first</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">sourcePost</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">tags</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">concat</span><span class="p">:</span><span class="w"> </span><span class="nv">sourcePost</span><span class="p">.</span><span class="nv">tags</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">uniq</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>

    <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Count the tags the comparison page has in common with this page. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">commonTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nv">tag</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nv">tags</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">tags</span><span class="w"> </span><span class="ow">contains</span><span class="w"> </span><span class="nv">tag</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">commonTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">commonTags</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">endfor</span><span class="w"> </span><span class="p">%}</span>

    <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Ignore comparison pages without enough common tags. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">commonTags</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">minCommonTags</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Log-scale the common tag count &amp; update the max value. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">capture</span><span class="w"> </span><span class="nv">logCommonTags</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">include</span><span class="w"> </span>log2.html<span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="nv">commonTags</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">endcapture</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">logCommonTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">logCommonTags</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">times</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">logCommonTags</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">maxLogCommonTags</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">maxLogCommonTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">logCommonTags</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>

      <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Create a reference array with the comparison page url &amp; log-scaled common tag count. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">post_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">split</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">post_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">post_data</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">push</span><span class="p">:</span><span class="w"> </span><span class="nv">post</span><span class="p">.</span><span class="nv">url</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">push</span><span class="p">:</span><span class="w"> </span><span class="nv">logCommonTags</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">relevantPosts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">relevantPosts</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">push</span><span class="p">:</span><span class="w"> </span><span class="nv">post_data</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="kr">endunless</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">endfor</span><span class="w"> </span><span class="p">%}</span>

<span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> If no comparison pages had enough tags, stop. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">relevantPosts</span><span class="p">.</span><span class="nf">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Initialize an array for scored posts. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">scoredPosts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">split</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="p">%}</span>

  <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Iterate over the reference array. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nv">relevantPosts</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Extract the data. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">post_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">logCommonTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">%}</span>

    <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Normalize the log-scaled common tag counts. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">normLogCommonTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">logCommonTags</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">divided_by</span><span class="p">:</span><span class="w"> </span><span class="nv">maxLogCommonTags</span><span class="w"> </span><span class="p">%}</span>

    <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Go get the post record. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">posts</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">where</span><span class="p">:</span><span class="w"> </span><span class="s2">"url"</span><span class="p">,</span><span class="w"> </span><span class="nv">post_url</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">first</span><span class="w"> </span><span class="p">%}</span>

    <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Calculate the comparison page's age in days, applying the default when needed. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">postDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">post</span><span class="p">.</span><span class="nv">date</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">date</span><span class="p">:</span><span class="w"> </span><span class="s1">'%s'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">ageInSeconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">now</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="nv">postDate</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">ageInSeconds</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">ageInDays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">defaultAge</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">ageInDays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ageInSeconds</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">divided_by</span><span class="p">:</span><span class="w"> </span><span class="mf">86400.0</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>

    <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Log-scale the comparison page age. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">capture</span><span class="w"> </span><span class="nv">logAge</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">include</span><span class="w"> </span>log2.html<span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="nv">ageInDays</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">endcapture</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">logAge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">logAge</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">times</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="p">%}</span>

    <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Calculate the relevance score. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">relevance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">normLogCommonTags</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">times</span><span class="p">:</span><span class="w"> </span><span class="nv">commonTagsWeight</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">minus</span><span class="p">:</span><span class="w"> </span><span class="nv">logAge</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">times</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">50000</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">round</span><span class="w"> </span><span class="p">%}</span>

    <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Encode the data in a sortable format &amp; push it to our scored posts array. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">sort_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">relevance</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">append</span><span class="p">:</span><span class="w"> </span><span class="s2">"|"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">append</span><span class="p">:</span><span class="w"> </span><span class="nv">post_url</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">append</span><span class="p">:</span><span class="w"> </span><span class="s2">"|"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">append</span><span class="p">:</span><span class="w"> </span><span class="nv">normLogCommonTags</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">append</span><span class="p">:</span><span class="w"> </span><span class="s2">"|"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">append</span><span class="p">:</span><span class="w"> </span><span class="nv">logAge</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">scoredPosts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">scoredPosts</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">push</span><span class="p">:</span><span class="w"> </span><span class="nv">sort_key</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">endfor</span><span class="w"> </span><span class="p">%}</span>

  <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Sort the scored posts. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">sorted_relevance_scores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">scoredPosts</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">sort</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">reverse</span><span class="w"> </span><span class="p">%}</span>

  <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Render the related-page HTML wrapper. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
  &lt;div class='page__related'&gt;
    <span class="p">{%</span><span class="w"> </span><span class="nt">include</span><span class="w"> </span>before-related.html<span class="w"> </span><span class="p">%}</span>
    &lt;h2 class='page__related-title'&gt;
      <span class="p">{{</span><span class="w"> </span><span class="nv">site</span><span class="p">.</span><span class="nv">data</span><span class="p">[</span><span class="s1">'ui-text'</span><span class="p">][</span><span class="nv">site</span><span class="p">.</span><span class="nv">locale</span><span class="p">].</span><span class="nv">related_label</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">default</span><span class="p">:</span><span class="w"> </span><span class="s1">'You May Also Enjoy'</span><span class="w"> </span><span class="p">}}</span>
    &lt;/h2&gt;
    &lt;div class='grid__wrapper'&gt;

      <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Create a counter &amp; iterate over the sorted array. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">maxRelatedCounter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nv">sorted_relevance_scores</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Extract the data from the array. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">split</span><span class="p">:</span><span class="w"> </span><span class="s2">"|"</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">relevance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">post_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">normLogCommonTags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">logAge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="p">%}</span>

        <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Go get the post data. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">posts</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">where</span><span class="p">:</span><span class="w"> </span><span class="s2">"url"</span><span class="p">,</span><span class="w"> </span><span class="nv">post_url</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">first</span><span class="w"> </span><span class="p">%}</span>

        <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Render some gelpful comments. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
        &lt;!-- post_url: <span class="p">{{</span><span class="w"> </span><span class="nv">post_url</span><span class="w"> </span><span class="p">}}</span> --&gt;
        &lt;!-- normLogCommonTags: <span class="p">{{</span><span class="w"> </span><span class="nv">normLogCommonTags</span><span class="w"> </span><span class="p">}}</span> --&gt;
        &lt;!-- logAge: <span class="p">{{</span><span class="w"> </span><span class="nv">logAge</span><span class="w"> </span><span class="p">}}</span> --&gt;
        &lt;!-- relevance: <span class="p">{{</span><span class="w"> </span><span class="nv">relevance</span><span class="w"> </span><span class="p">}}</span> --&gt;

        <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Render the actual page link. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">include</span><span class="w"> </span>archive-single.html<span class="w"> </span><span class="na">type</span><span class="o">=</span><span class="s2">"grid"</span><span class="w"> </span><span class="p">%}</span>

        <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c"> Update the counter &amp; break if we're done. </span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="nt">assign</span><span class="w"> </span><span class="nv">maxRelatedCounter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">maxRelatedCounter</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">plus</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">maxRelatedCounter</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">maxRelated</span><span class="w"> </span><span class="p">%}</span>
          <span class="p">{%</span><span class="w"> </span><span class="nt">break</span><span class="w"> </span><span class="p">%}</span>
        <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
      <span class="p">{%</span><span class="w"> </span><span class="nt">endfor</span><span class="w"> </span><span class="p">%}</span>
    &lt;/div&gt;
  &lt;/div&gt;
<span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
</code></pre></div></div>

<h2 id="cleaning-up">Cleaning Up</h2>

<p>The updated <code class="language-plaintext highlighter-rouge">page__related.html</code> widget presented above will give you a super relevant list of related posts &amp; pages at the bottom of any post or page on your Minimal Mistakes site… <em>assuming that post or page actually displays the widget!</em></p>

<p>Whether that widget is actually displayed is controlled by your layout file. For example, this page uses a <code class="language-plaintext highlighter-rouge">single</code> layout, which is implemented at <a href="https://github.com/mmistakes/minimal-mistakes/blob/master/_layouts/single.html"><code class="language-plaintext highlighter-rouge">/layouts/single.html</code></a>.</p>

<p>Right at the bottom of that file, you’ll see this block of code:</p>

<div class="language-liquid highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c">&lt;!-- only show related on a post page when `related: true` --&gt;</span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">id</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">related</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">site</span><span class="p">.</span><span class="nv">related_posts</span><span class="p">.</span><span class="nf">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">include</span><span class="w"> </span>page__related.html<span class="w"> </span><span class="na">posts</span><span class="o">=</span>site.related_posts<span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c">&lt;!-- otherwise show recent posts if no related when `related: true` --&gt;</span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">elsif</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">id</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">related</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="nt">include</span><span class="w"> </span>page__related.html<span class="w"> </span><span class="na">posts</span><span class="o">=</span>site.posts<span class="w"> </span><span class="p">%}</span>
<span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
</code></pre></div></div>

<p>A couple of issues here:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">page.id</code> only has a value on posts, not pages. So including <code class="language-plaintext highlighter-rouge">page.id</code> in these conditionals turns related-posts display off on pages, even when you’ve set <code class="language-plaintext highlighter-rouge">related: true</code> in the front matter.</p>
  </li>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">site.related_posts</code> array allows you to explicitly set related posts for all pages. If you’re doing that, you don’t need this widget.</p>
  </li>
  <li>
    <p>The old widget accepts an array of posts as an argument: either <code class="language-plaintext highlighter-rouge">site.related_posts</code> (see above) or <code class="language-plaintext highlighter-rouge">site.posts</code>, which contains ONLY blog posts, not pages or posts from other collections. The new widget doesn’t take any inputs.</p>
  </li>
</ul>

<p>So in <a href="https://github.com/mmistakes/minimal-mistakes/blob/master/_layouts/single.html"><code class="language-plaintext highlighter-rouge">single.html</code></a> and any other layout file where you see this code, replace it with this:</p>

<div class="language-liquid highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">{%</span><span class="w"> </span><span class="nt">comment</span><span class="w"> </span><span class="p">%}</span><span class="c">&lt;!-- only show related when `related: true` --&gt;</span><span class="p">{%</span><span class="w"> </span><span class="nt">endcomment</span><span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">page</span><span class="p">.</span><span class="nv">related</span><span class="w"> </span><span class="p">%}</span>
    <span class="p">{%</span><span class="w"> </span><span class="nt">include</span><span class="w"> </span>page__related.html<span class="w"> </span><span class="p">%}</span>
  <span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span>
</code></pre></div></div>

<p>Easy peasy! Now you can add <code class="language-plaintext highlighter-rouge">related: true</code> to the front matter of any post or page, and the new widget will display a list of related content at the bottom of the page, <strong>as long as…</strong></p>

<ul>
  <li>
    <p>you’ve added at least one tag to the post or page, and</p>
  </li>
  <li>
    <p>some other post or page has the same tag, and</p>
  </li>
  <li>
    <p>if it’s a post, it isn’t in the same collection as the page you are editing.</p>
  </li>
</ul>

<p class="notice--warning">As you do this, you are likely to discover that many of your pages and collection posts don’t have their <code class="language-plaintext highlighter-rouge">teaser</code> image or <code class="language-plaintext highlighter-rouge">excerpt</code> properties set. Add these to improve their look in the related posts widget!</p>

<h2 id="conclusion">Conclusion</h2>

<p>The related-posts widget implemented in the code above should satisfy a pretty broad swathe of use cases. Murphy’s law says yours is an exception. 🤣</p>

<p>If it is, just have a close look at the code. The math is the math, so any customizations will likely be in the logic that selects which posts and pages to evaluate for relevance.</p>

<p>The code that accomplishes this is ugly (thanks Liquid!) but not unclear. So go nuts, and feel free to drop me a comment if you run into any trouble!</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Topics: </strong>
    <span itemprop="keywords">
    
      <a href="/topics/jekyll" class="page__taxonomy-item p-category" rel="tag">jekyll</a>
    
    </span>
  </p>




        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2024-11-16T00:00:00+00:00">November 16, 2024</time></p>

      </footer>

      
        <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=karmaniverous&text=Related+Posts+With+Minimal+Mistakes%20https%3A%2F%2Fkarmanivero.us%2Frelated-posts-with-minimal-mistakes%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fkarmanivero.us%2Frelated-posts-with-minimal-mistakes%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://karmanivero.us/related-posts-with-minimal-mistakes/" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/betting-on-bali-my-journey-into-the-offshoring-business/" class="pagination--pager" title="Betting on Bali: My Journey Into the Offshoring Business
">Previous</a>
    
    
      <a href="/using-two-whatsapp-accounts-on-the-same-desktop/" class="pagination--pager" title="Using Two WhatsApp Accounts on the Same Desktop
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    




















  



  
  

  
  

  
  

  
  <div class='page__related'>
    
    <h2 class='page__related-title'>
      You may also enjoy
    </h2>
    <div class='grid__wrapper'>

      
      
        
        
        
        
        
        
      

        
      

        
        <!-- post_url: /unifying-web-presence-with-github-pages/ -->
        <!-- normLogCommonTags: 0.0 -->
        <!-- logAge: 6.001414026331019 -->
        <!-- relevance: 43999 -->

        
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/unify-web-presence-square.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/unifying-web-presence-with-github-pages/" rel="permalink">Unifying Web Presence with GitHub Pages
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i
          class="far fa-fw fa-calendar-alt"
          aria-hidden="true"
        ></i>
        
        <time datetime="2024-09-18T00:00:00+00:00">September 18, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-fw fa-clock"
          aria-hidden="true"
        ></i>
        
          4
          minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Eliminate content collisions with your primary GitHub Pages domain &amp; unify all your GitHub project documentation pages under a single subdomain.
</p>
  </article>
</div>


        
        
        
      
        
        
        
        
        
      

        
      

        
        <!-- post_url: /some-words-on-linkedin/ -->
        <!-- normLogCommonTags: 0.0 -->
        <!-- logAge: 6.251414026331019 -->
        <!-- relevance: 43749 -->

        
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/logo-linkedin.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/some-words-on-linkedin/" rel="permalink">Some Words on LinkedIn
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i
          class="far fa-fw fa-calendar-alt"
          aria-hidden="true"
        ></i>
        
        <time datetime="2024-09-02T00:00:00+00:00">September 2, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-fw fa-clock"
          aria-hidden="true"
        ></i>
        
          3
          minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Squaring the impossible circle: Where should your content actually live?
</p>
  </article>
</div>


        
        
        
      
        
        
        
        
        
      

        
      

        
        <!-- post_url: /hello-world-redux/ -->
        <!-- normLogCommonTags: 0.0 -->
        <!-- logAge: 6.392039026331019 -->
        <!-- relevance: 43608 -->

        
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/hello-world-redux.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/hello-world-redux/" rel="permalink">Hello World! (Redux)
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i
          class="far fa-fw fa-calendar-alt"
          aria-hidden="true"
        ></i>
        
        <time datetime="2024-08-24T00:00:00+00:00">August 24, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-fw fa-clock"
          aria-hidden="true"
        ></i>
        
          1
          minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Rediscovering blogging. Again.
</p>
  </article>
</div>


        
        
        
      
        
        
        
        
        
      

        
      

        
        <!-- post_url: /hello-again-world/ -->
        <!-- normLogCommonTags: 0.0 -->
        <!-- logAge: 9.683770503291377 -->
        <!-- relevance: 40316 -->

        
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/jekyll-square.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/hello-again-world/" rel="permalink">Hello (Again) World!
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i
          class="far fa-fw fa-calendar-alt"
          aria-hidden="true"
        ></i>
        
        <time datetime="2022-07-13T00:00:00+00:00">July 13, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i
          class="far fa-fw fa-clock"
          aria-hidden="true"
        ></i>
        
          2
          minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">You spend years of perfectly good writing time building gilded prisons for your words. If only there were a simple, beautiful way to write PORTABLE words.
</p>
  </article>
</div>


        
        
        
      
    </div>
  </div>

  
</div>
      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form onsubmit="return googleCustomSearchExecute();" id="cse-search-box-form-id" role="search">
    <label class="sr-only" for="cse-search-input-box-id">
      Enter your search term...
    </label>
    <input type="search" id="cse-search-input-box-id" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results">
    <gcse:searchresults-only></gcse:searchresults-only>
  </div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  
    <span class="love">Built for you with ❤️ on <a href="/bali/">Bali</a>!</span>
  

  <ul class="social-icons">
    
      <li>
        <strong>Contact</strong>&nbsp;&nbsp;&nbsp;</li>
    

    
      
        
          <li>
            <a href="https://twitter.com/karmaniverous" rel="nofollow noopener noreferrer">
              <i class="fa-brands fa-x-twitter" aria-hidden="true"></i>
              </a>
          </li>
        
      
        
          <li>
            <a href="https://techhub.social/@karmaniverous" rel="nofollow noopener noreferrer">
              <i class="fa-brands fa-mastodon" aria-hidden="true"></i>
              </a>
          </li>
        
      
        
          <li>
            <a href="https://github.com/karmaniverous" rel="nofollow noopener noreferrer">
              <i class="fa-brands fa-github" aria-hidden="true"></i>
              </a>
          </li>
        
      
        
          <li>
            <a href="https://www.linkedin.com/in/jscroft/" rel="nofollow noopener noreferrer">
              <i class="fa-brands fa-linkedin" aria-hidden="true"></i>
              </a>
          </li>
        
      
        
          <li>
            <a href="https://wa.me/17737500338" rel="nofollow noopener noreferrer">
              <i class="fa-brands fa-square-whatsapp" aria-hidden="true"></i>
              </a>
          </li>
        
      
        
          <li>
            <a href="https://t.me/karmaniverous" rel="nofollow noopener noreferrer">
              <i class="fa-brands fa-telegram" aria-hidden="true"></i>
              </a>
          </li>
        
      
        
          <li>
            <a href="https://calendly.com/karmaniverous" rel="nofollow noopener noreferrer">
              <i class="fa-regular fa-calendar-plus" aria-hidden="true"></i>
              </a>
          </li>
        
      
    

    
      <li>
        <a href="/feed.xml">
          <i class="fas fa-fw fa-rss-square" aria-hidden="true"></i>
           </a>
      </li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024
  <a href="https://karmanivero.us">some words</a>. Powered by
  <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a>
  &amp;
  <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>


<script>
  (function () {
    var cx = '960ee5d1b2fec4509';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();

  function googleCustomSearchExecute() {
    var input = document.getElementById('cse-search-input-box-id');
    var element = google.search.cse.element.getElement('searchresults-only0');
    if (input.value == '') {
      element.clearAllResults();
    } else {
      element.execute(input.value);
    }
    return false;
  }

  
    $(document).ready(function () {
      $('input#cse-search-input-box-id').on('keyup', function () {
        googleCustomSearchExecute();
      });
    });
  
</script>




    
  <script>
    var disqus_config = function () {
      this.page.url = "https://karmanivero.us/related-posts-with-minimal-mistakes/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/related-posts-with-minimal-mistakes"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://some-words.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  




  </body>
</html>
